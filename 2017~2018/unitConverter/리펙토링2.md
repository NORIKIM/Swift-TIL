# 단위변환기

### 리펙토링 2

**리펙토링 이유**

- 함수 내 중복 사용되는 변수와 상수가 많다
- 함수 내 파라미터가 같다

<br>

- 따라서, 구조체를 공부하고 활용한다.

<br>

**변경사항**

- 중복사용되는 변수와 상수, 파라미터를 구조체의 프로퍼티로 선언
- 모든 함수를 실행하고 총괄하는 main함수 getValue를 mutating 함수로

```swift
import Foundation

print("# 값을 입력해주세요 -> 숫자+단위(예 : 25inch m)\n끝내려면 'quit' 혹은 'q'를 입력해주세요 >_<")

// 입력값 받기
func getInput() -> String {
    let input = readLine() ?? ""
    return input
}

// input에서 숫자만 분리
func getUnitNumber(_ userInput: String) -> String {
    var num = ""
    num = userInput.trimmingCharacters(in: CharacterSet.decimalDigits.inverted) // 입력값 숫자만 가져옴
    return num
}

// input에서 단위 분리
func getUnitString(_ userInput: String) -> Array<String> {
    var unit = ""
    unit = userInput.trimmingCharacters(in: CharacterSet.letters.inverted) // 입력값 문자만 가져옴
    let separateUnit = unit.components(separatedBy: " ") //["cm","m"]
    return separateUnit
}

//바꾸고 싶은 단위
func getFromUnit(_ userInput: String) -> String {
    let getUnitValue = getUnitString(userInput)
    let from = getUnitValue[0]
   return from // "cm"
}

//바꾸려는 단위
func getToUnit(_ userInput: String) -> String {
    let getUnitValue = getUnitString(userInput)
    var to = ""
    if getUnitValue.count == 1 {
        to = ""
    }
    if getUnitValue.count == 2 {
        if getUnitValue[1].contains(",") {
            let separateUnit = getUnitValue[1].components(separatedBy: ",")
            to = separateUnit[0]
        } else {
            to = getUnitValue[1]
        }
    }
    return to
}

// 쉼표 뒤 단위(두번째 바꾸려는) 분리
func getSecToUnit(_ userInput: String) -> String {
    var secTo = ""
    let to = getToUnit(userInput)
    if to == "" {
        secTo = ""
    } else {
        let getUnitValue = getUnitString(userInput)
        if getUnitValue[1].contains(",") {
            let separateUnit = getUnitValue[1].components(separatedBy: ",")
            secTo = separateUnit[1]
        }
    }
    return secTo
}

// 받은 입력값 딕셔너리로 만들기
func makeDic(_ userInput: String) -> [String:String] {
    var saveValue:[String:String] = [:]
    saveValue = ["number":getUnitNumber(userInput),"from":getFromUnit(userInput),"to":(getToUnit(userInput)),"secTo":getSecToUnit(userInput)]
    // ex.userInput = 18cm yard,inch
    // [number:18, from:cm, to:yard, secTo:inch] - string타입
    return saveValue
}

// 길이 단위
enum length: Double {
    case cm = 1
    case m = 100
    case inch = 2.54
    case yard = 91.44
    
    static let lengthType = [cm,m,inch,yard]
}

// 단위변환을 위한 구조체
struct Convert {
    var inputDic:[String:String]
    
    // 기본단위 변환함수(예.180cm -> [m,inch,yard])
    func convertBaseTo() -> Array<String>{
        let number = Double(inputDic["number"] ?? "")
        let from = inputDic["from"]
        let to = inputDic["to"]
        var result:[String] = []
        
        if from == "cm" && to == "" {
            for lengthCase in length.lengthType {
                result.append(String(number! / lengthCase.rawValue) + String(describing: lengthCase))
            }
            result.remove(at: 0)
        }
        return result
    }

    // 기본단위 아닐때 기본단위로 변환(예.180m -> cm)
    // 숫자 * from
    func convertBase() -> String {
        let number = Double(inputDic["number"] ?? "")
        let from = inputDic["from"]
        var result = ""
        
        if from != "" && from != "cm" {
            for lengthCase in length.lengthType {
                if from == String(describing: lengthCase) && from != "cm" {
                    result.append(String(number! * lengthCase.rawValue) + "cm")
                }
            }
        }
        return result
    }

    // from -> to // from -> to,secTo
    func convertFromTo() -> Array<String> {
        let from = inputDic["from"]
        let to = inputDic["to"]
        let sec = inputDic["secTo"]
        var toRawVal = 0.0
        var toUnit = ""
        var secRawVal = 0.0
        var secUnit = ""
        let convertBaseResult = convertBase() // "18000cm"
        let separateBaseNum = convertBaseResult.trimmingCharacters(in: CharacterSet.decimalDigits.inverted) // 18000
        var result:[String] = []
        
        if from != "cm" && to != "" || sec != "" {
            for lengthCase in length.lengthType {
                if to == String(describing: lengthCase) {
                    toRawVal = lengthCase.rawValue
                    toUnit = String(describing: lengthCase)
                }
                if sec == String(describing: lengthCase) {
                    secRawVal = lengthCase.rawValue
                    secUnit = String(describing: lengthCase)
                }
            }
            result.append(String(Double(separateBaseNum)! / toRawVal) + toUnit)
            
            if sec != "" {
            result.append(String(Double(separateBaseNum)! / secRawVal) + secUnit)
            }
        }
        return result
    }
    
    // main 실행 구간
    mutating func getValue() {
        var flag:Bool = true
        while flag {
            let userInput = getInput()
            self.inputDic = makeDic(userInput)
            let from = self.inputDic["from"]
            let to = self.inputDic["to"]
            let sec = self.inputDic["secTo"]
            
            if userInput == "quit" || userInput == "q" {
                flag = false
            }
            if from == "cm" && to == "" {
                print(convertBaseTo())
            } else if from != "" && from != "cm" && to == "" {
                print(convertBase())
            } else if from != "cm" && to != "" || sec != "" {
                print(convertFromTo())
            }
        }
    }
}
var convertUnit = Convert(inputDic: [String : String]())
convertUnit.getValue()
```

<br>

**두번째 리펙토링을 마치고….**

여전히 마음에 들지 않는 나의 코드를 구조체를 활용하여 길이단위만 변경해보았다.

완전한 구조체 형식의 리펙토링은 아니지만 구조체를 한번 써보니 훨씬 더 깔끔하고 간결한 로직이 가능하다는 것을 실감했다

더이상의 욕심은 접어두고 사다리게임에 들어간다.

(사다리게임에서도 구조체를 사용하자)

리펙토링도 많이 하다보면 어렵지 않게 할 수 있겟지만 난 여전히 실력이 안되다 보니 정신적고통에 시달리며 겨우겨우 내가 맞춰둔 기한 일주일에 걸쳐 수정을 했다.

연말이라 송년회 및 친구 생일 때문에 그 일주일 마져도 모두 사용하지 못하여 마지막날에는 밤 늦게 까지 마무리를 하였다.

하지만, 이렇게 마무리 한 단위변환기는 여전히 마음에 들지 않는다.

두번째 리펙토링을 시작한다.

